<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Rain</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body {
    margin: 0;
    background: #0b0b0b;
    color: #6fa8dc;
    font-family: monospace;
    overflow: hidden;
  }

  #rain {
    position: fixed;
    inset: 0;
    pointer-events: none;
  }

  .drop {
    position: absolute;
    white-space: nowrap;
    opacity: 0.85;
    animation-name: fall;
    animation-timing-function: linear;
    animation-fill-mode: forwards;
  }

  @keyframes fall {
    from {
      transform: translateY(-10px);
      opacity: 0.9;
    }
    to {
      transform: translateY(110vh);
      opacity: 0;
    }
  }

  #input {
    position: fixed;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    border: 1px solid #333;
    color: #aaa;
    padding: 0.5rem;
    width: 80%;
    max-width: 400px;
    font-family: monospace;
  }
</style>
</head>

<body>

<div id="rain"></div>

<input
  id="input"
  type="text"
  placeholder="Add a word or lineâ€¦"
  maxlength="60"
/>

<script>
const rain = document.getElementById("rain");
const input = document.getElementById("input");

const chars = ["|", ".", ":", "/", "\\", "~"];
const poem = [
  "water moves",
  "color waits",
  "rain becomes cloth",
  "held briefly",
  "falling without return"
];

// create a single falling element
function createDrop(text, speedMultiplier = 1) {
  const drop = document.createElement("div");
  drop.className = "drop";
  drop.textContent = text;

  const x = Math.random() * window.innerWidth;
  const baseDuration = 5 + Math.random() * 6;
  const duration = baseDuration / speedMultiplier;

  drop.style.left = x + "px";
  drop.style.animationDuration = duration + "s";

  rain.appendChild(drop);
  setTimeout(() => drop.remove(), duration * 1000);
}

// random ASCII character
function randomChar() {
  return chars[Math.floor(Math.random() * chars.length)];
}

// --- RAIN LAYERS ---

// slow mist
setInterval(() => {
  createDrop(randomChar(), 0.6);
}, 250);

// normal rain
setInterval(() => {
  createDrop(randomChar(), 1);
}, 120);

// fast streaks
setInterval(() => {
  createDrop(randomChar(), 1.8);
}, 300);

// occasional poem lines (medium-slow)
setInterval(() => {
  const line = poem[Math.floor(Math.random() * poem.length)];
  createDrop(line, 0.8);
}, 5000);

// --- BROKEN TEXT INPUT ---

function breakIntoFragments(text) {
  // split by spaces, then lightly fragment words
  return text.split(" ").flatMap(word => {
    if (word.length <= 3) return [word];
    const mid = Math.floor(word.length / 2);
    return [word.slice(0, mid), word.slice(mid)];
  });
}

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && input.value.trim() !== "") {
    const fragments = breakIntoFragments(input.value.trim());

    fragments.forEach((frag, i) => {
      setTimeout(() => {
        const speed = 0.7 + Math.random() * 1.2;
        createDrop(frag, speed);
      }, i * 200);
    });

    input.value = "";
  }
});
</script>

</body>
</html>
